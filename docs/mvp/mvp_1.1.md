# InvestLab MVP 1.1 产品需求文档（PRD）

## 0. 版本信息
- 文档版本：v1.1
- 适用范围：InvestLab Web（前端 Vue3 + 后端 Spring Boot）
- 目标发布日期：待定

## 1. 背景与目标
在 MVP 基础上增强策略复盘与资产查看体验：
- 提升策略详情页的可维护性（交易、观点的编辑/删除，持仓备注可阅读）。
- 实现账户到交易的可追溯查看。
- 新增标的详情页，提供 K 线与核心技术指标，支持观点标记。
- 补全路由规范，便于分享与直达。

## 2. 范围（Scope）
### 本次纳入
1) 策略详情页增强  
   - 交易记录：支持编辑、删除。  
   - 大V观点：支持编辑、删除。  
   - 持仓标的：显示备注；备注过长时 hover 弹出阅读面板。
2) 账户管理联动  
   - 在账户列表中可查看该账户关联的交易记录（列表/弹窗）。
3) 标的详情页  
   - 新增独立页面，支持 K 线（日/周/月/年线）和指标：布林线、MA51、MA120、MA250、MA850。  
   - 数据来源：ashare。
4) 观点与 K 线关联  
   - 大V观点可选择关联投资标的。  
   - 在 K 线上按观点日期标注点，hover 展示完整观点摘要。
5) 路由规范  
   - 策略详情各 tab 独立路由：`/strategies/{id}/trade`、`/strategies/{id}/assets`、`/strategies/{id}/viewpoints` 等。

### 本次不纳入
- 实盘下单、实时行情推送。
- 指标个性化配置（自定义参数）。
- 跨账户/跨策略的聚合分析。

## 3. 角色与用户故事
- 个人投资者 / 策略执行者
  - 希望快速编辑/删除错误的交易或观点。
  - 希望在账户视角下查看所有关联交易。
  - 希望查看某标的的多周期 K 线与核心指标，并结合观点做决策。
  - 希望从链接直达某个策略的特定模块（交易/持仓/观点）。

## 4. 功能需求
### 4.1 策略详情页增强
**交易记录 Tab**
- 列表项增加“编辑”“删除”操作。删除前确认弹窗；编辑使用弹窗或侧滑抽屉，字段同创建。
- 编辑提交后更新列表，不刷新整页。

**大V观点 Tab**
- 列表项增加“编辑”“删除”。删除前确认；编辑弹窗支持修改标题/摘要/链接/标签/日期/关联标的。

**持仓标的 Tab**
- 列备注列显示，内容过长时截断（如 1 行/2 行），hover 显示浮层/Popover 展示完整备注，可滚动。

### 4.2 账户管理联动
- 在账户列表表格增加“查看交易”操作：弹窗展示该账户的交易列表（可按时间排序、筛选策略/标的）。
- 字段：日期、策略、标的、类型、价格、数量、手续费、备注。

### 4.3 标的详情页
- 路由：`/assets/{id}`。
- 展示：标的基本信息、当前策略关联信息。
- K 线：
  - 周期：日 / 周 / 月 / 年线（年线为年度级别收盘/开高低范围）。
  - 指标：布林线、MA51、MA120、MA250、MA850。
  - 数据源：ashare；若短期无法直连，先用 mock/本地静态模拟接口预留。
- 交互：
  - 指标可开关显示。
  - 鼠标 hover 展示 OHLC、指标值。
  - 观点标记（见 4.4）。

### 4.4 观点与 K 线关联
- 创建/编辑观点时可选择关联标的（下拉选择当前策略下的标的，或搜索）。
- 标记展示：
  - 在标的详情页 K 线上按 viewpoint.date 打点。
  - hover 打点显示标题、标签、日期、摘要（截断），点击/展开显示完整摘要与链接。

### 4.5 路由规范
- 策略详情子路由：
  - 持仓：`/strategies/{id}/assets`
  - 交易：`/strategies/{id}/trade`
  - 观点：`/strategies/{id}/viewpoints`
  - 概览：`/strategies/{id}/overview`（可选保留）
- 标的详情：`/assets/{id}`
- 账户交易弹窗：由 `/accounts` 列表触发，不单独路由。

## 5. 交互与 UX 要点
- 编辑/删除均需二次确认或清晰的关闭操作；失败提示。
- 持仓备注 hover 浮层：最大宽度/高度，支持滚动；移动端可用点击弹层替代。
- K 线视图：默认日线；切换周期不刷新整页，仅请求数据并重绘图表。
- 观点打点：同一日期多个观点时堆叠或聚合提示（如“3条观点”）。

## 6. 数据与接口（概要）
> 仅列新增/变更字段与接口，详细字段可在实现时补充接口文档。

### 6.1 现有接口补充
- 交易（Trade）：支持 PUT / DELETE。
- 观点（Viewpoint）：支持 PUT / DELETE；新增字段 `assetId`（可选）。
- 资产（Asset）：GET 列表返回备注字段 note；详情接口返回关联策略。

### 6.2 新接口
- 账户交易查询：`GET /api/v1/accounts/{id}/trades`（支持分页/筛选 strategyId/assetId/date range）。
- 标的详情：`GET /api/v1/assets/{id}`（含基本信息、所属策略）。
- 标的 K 线数据：`GET /api/v1/assets/{id}/kline?period=day|week|month|year`  
  返回：时间、open/high/low/close/volume，指标字段（可在后端计算或前端计算，需统一格式）。

### 6.3 指标计算（若后端计算）
- MA：简单移动平均，窗口分别为 51 / 120 / 250 / 850。
- 布林线：默认 period=20, k=2（若需可前端参数化，当前固定）。
- 年线：按年度聚合（可取年度最后一个交易日的 OHLC 或年度区间高低+收盘）。

### 6.4 数据源
- 优先使用 ashare 接口获取行情/K 线。若暂无法联通，提供 mock 数据接口，并保留数据源适配层，后续替换。

## 7. 验收标准
- 策略详情页：交易与观点均可编辑/删除；持仓备注 hover 可完整阅读。
- 账户列表：可查看该账户的全部关联交易记录。
- 标的详情：可切换日/周/月/年线；可显示/隐藏布林线、MA51/120/250/850；数据正常渲染。
- 观点打点：与关联标的、日期对应，hover 可见内容。
- 路由：上述子路由可直接访问并展示正确 tab。

## 8. 风险与约束
- 行情/K 线数据获取受 ashare 连通性影响，需提供降级方案（mock）。
- 长周期指标（MA250/MA850）需要足够历史数据；缺少时需有降级提示。
- 多观点打点的视觉拥挤需做聚合/提示。

## 9. 里程碑（建议）
- T+1：接口与路由设计、前端页面骨架、mock 数据打通。
- T+3：交易/观点编辑删除、账户交易查询、持仓备注浮层。
- T+5：标的详情页 K 线与指标、观点打点。
- T+6：联调与验收。
