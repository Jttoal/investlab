---
name: project rule
description: This is a project rule rule
---

# InvestLab 项目开发规则（Cursor Rules）

> 本文件适用于 `investlab/` 项目：\
> - 后端：**Kotlin + Spring Boot**\
> - 前端：**Vue 3 + Vite + Pinia（JavaScript）**\
> - 文档：**Markdown（按功能维度组织）**\
> - 存储：**SQLite**\
> - 规范文件：`.cursor/rules` + 本文档

------------------------------------------------------------------------

## 1. 代码与目录约定

### 1.1 项目结构（约定不破）

    investlab/
    ├── backend/        # Spring Boot 服务
    ├── frontend/       # Vue 3 Web 应用
    ├── docs/           # 功能维度文档
    └── .cursorrules    # Cursor 自动规则

-   **禁止**擅自新增平级顶层目录。
-   临时/实验代码统一放在各项目 `sandbox/`（不会进入生产）。

------------------------------------------------------------------------

## 2. Git 工作流

### 2.1 分支规范

-   `main`：稳定、仅可从 `release/*` 合并
-   `develop`：日常开发集成
-   `feature/<name>`：功能开发
-   `fix/<name>`：缺陷修复
-   `refactor/<name>`：重构

> 所有 PR 必须：代码审查 ✔、CI 通过 ✔、测试覆盖 ✔。

### 2.2 Commit 规范（必遵）

    <type>: <subject>

    <body>

可选 type：`feat | fix | docs | style | refactor | test | build | chore`

示例：

    feat: 支持交易策略回测结果导出

------------------------------------------------------------------------

## 3. 后端规范（Kotlin + Spring Boot）

### 3.1 结构约定

    backend/src/main/kotlin/com/investlab/
    ├── api/         # Controller
    ├── service/     # 领域逻辑
    ├── repository/  # 数据访问（SQLite）
    ├── model/       # DTO/Entity
    └── config/      # 配置

### 3.2 REST API 约束

-   统一使用 `/api/v1/...`
-   资源使用**名词复数**：`/users /strategies`
-   操作语义靠 HTTP Method：`GET/POST/PUT/PATCH/DELETE`
-   错误统一：

``` json
{
  "code": "RESOURCE_NOT_FOUND",
  "message": "对象不存在",
  "traceId": "..."
}
```

### 3.3 异常与日志

-   统一异常处理器 `@ControllerAdvice`
-   **禁止**打印敏感信息
-   生产日志级别：`INFO`；异常使用 `ERROR`。

### 3.4 数据库（SQLite）

-   访问层统一使用 Spring Data / JPA
-   禁止在 Service 中写 SQL
-   迁移工具使用 **Flyway**（`db/migration`）
-   字段命名：`snake_case`
-   **必须**提供索引策略说明

### 3.5 测试

-   单元测试：`JUnit5`
-   控制器使用 `@WebMvcTest`
-   所有 Service 新功能必须 \>= **70% 覆盖**。

------------------------------------------------------------------------

## 4. 前端规范（Vue 3 + Vite + Pinia）

### 4.1 目录结构

    frontend/src/
    ├── api/          # 后端接口封装
    ├── stores/       # Pinia
    ├── views/        # 页面
    ├── components/   # 复用组件
    ├── router/       # 路由
    └── utils/        # 工具函数

### 4.2 代码风格

-   统一 **JavaScript (ES2022)**，避免混用 TS
-   组件命名：`PascalCase`
-   变量命名：`camelCase`
-   样式：`scoped` + BEM
-   禁止在组件直接调用 axios------统一走 `api/`

### 4.3 状态管理（Pinia）

-   只放**可共享业务状态**
-   纯 UI 状态放组件内部
-   状态变更通过 `actions`，避免外部直接修改

### 4.4 接口调用

``` js
// api/example.js
export function fetchStrategies() {
  return http.get('/api/v1/strategies')
}
```

-   错误 toast 由 **统一拦截器** 处理
-   需要防抖/节流的接口必须声明

### 4.5 构建要求

-   Vite 构建大小 \< **2MB gzip**
-   必须开启按需加载与代码拆分
-   环境变量：`.env.development / .env.production`

------------------------------------------------------------------------

## 5. 文档规范（docs/）

### 5.1 组织方式（功能维度）

    docs/
    ├── auth/
    ├── strategy/
    ├── report/
    └── settings/

每个功能至少包含：

-   `overview.md`：背景 + 目标\
-   `api.md`：接口说明\
-   `ux.md`：关键交互\
-   `edge-cases.md`：边界条件

### 5.2 写作要求

-   只写**事实**与**决策**
-   每个变更记录 `Changelog`
-   图用 `Mermaid` / 简单流程图

------------------------------------------------------------------------

## 6. 安全与合规

-   禁止提交：密钥、Token、数据库文件
-   必须使用 `.env` 并加入 `.gitignore`
-   所有外部依赖需要记录来源与版本
-   API 需要鉴权（除公开健康检查）

------------------------------------------------------------------------

## 7. 质量检查（CI）

-   Lint：`ktlint` + `eslint`
-   测试：后端 + 前端单测
-   构建：生产包可运行
-   安全：依赖漏洞扫描

> 任何一项失败，**禁止合并**。

------------------------------------------------------------------------

## 8. 性能要求

-   接口 P95 \< **300ms**
-   列表接口默认分页
-   前端首屏渲染 \< **2.5s**（良好网络）
-   大对象必须走压缩或流式接口

------------------------------------------------------------------------

## 9. 发布流程

1.  合并到 `develop` → 集成测试\
2.  打 `release/x.y.z` 版本 → 验收\
3.  合入 `main` → 打 Tag → 构建产物\
4.  生成发布说明（CHANGELOG）

------------------------------------------------------------------------

## 10. 代码评审清单（PR Checklist）

-   [ ] 是否遵守目录结构\
-   [ ] 是否补充文档\
-   [ ] 是否添加/更新测试\
-   [ ] 是否有安全隐患\
-   [ ] 性能是否合理\
-   [ ] 接口是否稳定且向后兼容

------------------------------------------------------------------------

## 11. 游离规则

-   若规范与实现冲突，**优先修正实现并回写规范**\
-   新技术试点需评估：风险、回滚、收益\
-   用户没有明确要求编写总结文档的时候，不要写文档，优先实现用户提出的代码修改要求。\
-   默认选择 **简单、可维护、清晰** 的方案

------------------------------------------------------------------------

> 本文件与 `.cursorrules` 同步维护。若存在差异，以**本文件为准**。
